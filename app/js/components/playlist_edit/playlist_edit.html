<div ui-view></div>

<div class="playlist-edit">
  <playlist-workflow ng-if="playlist_edit.newPlaylist"></playlist-workflow>
  <h1 class="text-center">{{playlist_edit.title}}</h1>

  <div class="row playlist-container">
    <div class="small-18 medium-16 medium-centered large-12 large-centered columns goals-container">
      <div class="row">
        <form id="playlistForm" ng-submit="playlist_edit.savePlaylist()">
          <input required name="class_name" class="class_name" type="text" placeholder="{{'CLASS_GIVE_NAME' | translate}}..." ng-model="playlist_edit.playlist.Name">
        </form>
      </div>
      <div class="row goal-name ride-type" sticky-header>
        <div>
          <div class="icon"><img src="/img/playlists/{{playlist_edit.playlist.IconFileName}}"></div>
          <h2 ng-bind-html="playlist_edit.playlist.TemplateName"></h2> {{playlist_edit.playlist.ClassLengthMinutes}}:00
          <span class="length" ng-class="{'error': !playlist_edit.checkPlaylistLength() && playlist_edit.checkAllGoalsHaveTracks()}"><span class="box">{{playlist_edit.playlistTracksLength | minutes}}</span></span>
          <p class="error" ng-if="!playlist_edit.checkPlaylistLength() && playlist_edit.checkAllGoalsHaveTracks()">Try to get your class closer to {{playlist_edit.playlist.ClassLengthMinutes}} minutes by reviewing your track choices.</p>
          <p class="error" ng-if="!playlist_edit.checkWhenEditingEveryGoalHasATrack()">Each goal needs a track.</p>
        </div>
      </div>
      <div class="row goal" data-ng-repeat="playlistGoal in playlist_edit.playlist.PlaylistGoals | orderBy:'SortOrder'">
        <div class="goal-container" ng-class="{'active': playlist_edit.isGoalActive(playlistGoal)}">
          <div class="row goal-name" ng-click="playlist_edit.goalClicked(playlistGoal)">
            <div class="large-10 columns">
              <h4 ng-class="{'has-track' : playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].PlaylistGoalTracks.length > 0}">{{playlistGoal.Goal.Name}}</h4>
            </div>
            <div class="large-8 columns text-right">
              <a ng-show="playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].PlaylistGoalTracks.length === 0">+ Add a song</a>
            </div>
          </div>
          <div class="row" ng-show="playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].PlaylistGoalTracks.length > 0">
            <div class="bin" ng-class="{'dropped' : playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].PlaylistGoalTracks.length > 0}" id="bin{{playlistGoal.ArrayId}}">
              <div class="row track dropped" id="playlist{{playlistGoal.Id}}{{track.Track.MusicProviderTrackId}}" data-ng-repeat="track in playlistGoal.PlaylistGoalTracks">
                <div class="large-1 small-1 columns play" id="track{{track.Track.MusicProviderTrackId}}" ng-click="playlist_edit.playTrack(track.Track);" ng-class="{'playing': track.Track.playing}">
                  <a href="#">{{'PLAY' | translate}}</a>
                </div>
                <div class="large-11 small-11 columns">
                  <span class="track-name">{{track.Track.Name | limitTo : 80}}<span ng-if="track.Track.Name.length > 80">&hellip;</span></span> <span class="artist">{{track.Track.Artist}}</span> | <span class="bpm">{{track.Track.Bpm}} {{'BPM' | translate}}</span>
                </div>
                <div class="large-4 columns time text-center">
                  <span class="position" ng-show="track.Track.currentTime >= 0">{{track.Track.currentTime | minutes}}</span> {{track.Track.DurationSeconds | minutes}}
                </div>
                <div class="large-1 columns remove" ng-click="playlist_edit.removeTrack(playlistGoal.ArrayId, track)"> - </div>
              </div>
            </div>
          </div>
          <div class="row goal-meta" ng-click="goal.show = !playlistGoal.show" ng-show="playlistGoal.show && playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].PlaylistGoalTracks.length > 0">
            <ul class="large-block-grid-2">
              <li ng-repeat="goaloption in playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].Goal.GoalOptions">
                <goal_option data-goaloptiondata="{{goaloption}}" data-length="{{playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].Goal.GoalOptions.length}}" data-bpm="{{playlistGoal.PlaylistGoalTracks[0].Track.Bpm}}"></goal_option>
              </li>
            </ul>
            <div class="row notes">
              {{'TRACK_NOTES' | translate}}
              <form name="playlistGoalNote{{playlistGoal.ArrayId}}">
                <textarea name="note" maxlength="200" ng-maxlength="200" ng-change="playlist_edit.playlistGoalNoteCreate(playlistGoal.ArrayId, 0)" ng-model-options="{updateOn : 'change blur'}" ng-model="playlist_edit.playlist.PlaylistGoals[playlistGoal.ArrayId].PlaylistGoalNotes[0].NoteText"></textarea>
                <span class="maxlength">Max 200 characters</span>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <a style="float:left" ui-sref="dashboard">Cancel</a>
        <button ng-show="playlist_edit.checkWhenEditingEveryGoalHasATrack()" type="submit" form="playlistForm" class="round" style="float:right">{{playlist_edit.submitButtonText()}}</button>
      </div>
    </div>
  </div>
</div>
